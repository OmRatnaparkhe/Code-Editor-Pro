
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url=env("DATABASE_URL")
}

enum RoomRole {
  host
  editor
  viewer
}

model User{
  id String @id @default(uuid())
  email String @unique
  clerkId String @unique
  name String
  projects Project[]
  roomParticipants RoomParticipant[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Room {
  id String @id @default(uuid())
  roomId String @unique
  participants RoomParticipant[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model RoomParticipant {
  id String @id @default(uuid())
  roomId String
  userId String
  role RoomRole @default(editor)
  lastSeenAt DateTime @default(now())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  room Room @relation(fields: [roomId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([roomId, userId])
}

model Project{
  id String @id@default(uuid())
  userId String
  name String
  files File[]
  isPublic Boolean @default(false)
  user User @relation(fields:[userId],references:[id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model File{
  id String @id @default(uuid())
  name String
  language String
  content String
  projectId String
  project Project @relation(fields:[projectId], references:[id])
}